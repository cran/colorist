<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Introduction to colorist</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Introduction to colorist</h1>



<p>Maps play a central role in research aimed at understanding how and
why wildlife distributions shift through space and time. They give form
to complex sets of assumptions, hypotheses, and predictions and, in
doing so, offer the promise of embodying detailed knowledge about
species and individuals. Traditionally, biologists have used range maps,
and home range maps, to describe animal distributions in space and time.
Despite their historical success as representational forms, they are
increasingly incapable of communicating our knowledge of wildlife
distributions.</p>
<p>Technologies for acquiring and modeling wildlife distribution data
have improved dramatically in recent years. As a result, we possess ever
more detailed descriptions of animal occurrence, abundance, and density
in space and time. This glut of high-resolution spatiotemporal
information comes with its own set of visualization challenges, however.
Intuitively, we might try to reveal patterns of spatiotemporal stasis
and change by stacking distributions on top of each other, but this
strategy often results in underlying data being occluded or muddied,
depending on whether and how layers are combined.</p>
<p>We developed the <code>colorist</code> package to provide researchers
with a variety of options for exploring and communicating information
about wildlife distributions in space and time. <code>colorist</code>
emphasizes the use of color to indicate where, when, and how
consistently species, individuals, or groups of animals can be found. In
order to do this effectively, colorist takes information from a stack of
rasters, processes it, and links it to HCL (hue-chroma-luminance) color
palettes in specific ways so that occurrence, abundance, or density
values have nearly equal perceptual weights in resulting maps.</p>
<div id="usage" class="section level2">
<h2>Usage</h2>
<p>Like other visualization tools, we suggest that the
<code>colorist</code> package may be useful to researchers in different
ways throughout the process of building knowledge. Researchers may want
to use <code>colorist</code> to explore preliminary data through
visualizations, with the goal of developing or refining research
questions. Alternatively, researchers may come to <code>colorist</code>
having already discovered something interesting about wildlife
distributions that they would like to communicate in visualizations.
Regardless of where researchers are in the process of discovery, it is
important to remember that <code>colorist</code> functions were built to
handle and display data. People are still in charge of their
interpretation.</p>
<p>The <code>colorist</code> package works on raster data stored as
<code>RasterStack</code> objects. Individual raster layers might
represent an ordered temporal sequence of species distributions or
utilization distributions. Alternatively, raster layers might represent
an unordered set of distributions for multiple species, or individuals,
within a single time period. Whatever temporal or identity relationships
exist within the stack, all raster layers should contain values in the
same units (e.g., abundance, occurrence, or probability density) to
ensure that they can be meaningfully compared.</p>
<p>When preparing raster layers, users should be sure to distinguish
raster cells with 0 values (e.g., cells in which a species is predicted
to occur with probability 0) from cells with NA values (e.g., cells for
which occurrence predictions could not be made). This distinction is
important for identifying areas where knowledge of distributions is
incomplete. In addition, because colorist functions can take time to
process large <code>RasterStack</code> objects, researchers may want to
aggregate their raster data spatially and/or temporally while exploring
alternative visualization strategies.</p>
<p>The basic workflow for colorist is as follows:</p>
<ol style="list-style-type: decimal">
<li><strong>Metrics</strong>: Users calculate metrics to describe their
distributions.</li>
<li><strong>Color palette</strong>: Users choose a color palette to
enable visualization of metrics.</li>
<li><strong>Map</strong>: Users combine metrics and a palette to map
distributions in a series of small multiples or in a single map.</li>
<li><strong>Legend</strong>: Users generate a legend to accompany their
map.</li>
</ol>
</div>
<div id="examples" class="section level2">
<h2>Examples</h2>
<p>Here, we describe three use cases to illustrate <code>colorist</code>
functions and how they can be combined to map distributions.</p>
<div id="map-a-species-distribution-across-the-annual-cycle" class="section level3">
<h3>1. Map a species distribution across the annual cycle</h3>
<p>There is growing interest in characterizing wildlife distributions
across the full-annual cycle, as opposed to one or two seasons, so that
we can better understand the places and times at which populations are
vulnerable. Maps play an important role in that process. In the past,
range maps for resident species typically contained a single block of
color along with political boundaries that indicated where a species can
be found throughout the year. In contrast, range maps for migratory
species typically contained several blocks of color indicating where a
species might be found during a particular season, or throughout the
entire year.</p>
<p>Here, we use aggregated <a href="https://ebird.org/science">eBird
Status and Trends</a> data for <a href="https://ebird.org/science/status-and-trends">Field Sparrow</a>
(<em>Spizella pusilla</em>) to illustrate a different strategy for
creating annual cycle maps, one that leverages continuous occurrence
data (rather than categorical presence-absence data) to describe where
and when viewers might be able to find a species. Field Sparrow is a
relatively small bird that is commonly found in open habitats throughout
eastern North America. It is often considered a partial migrant in that
some populations move throughout the year, while others are stationary.
This results in heterogeneity in when, where, and how consistently birds
can be found in space-time.</p>
<p>We start by loading the <code>fiespa_occ</code> data set. It contains
twelve raster layers, one for each month of the year. Cell values in
each layer indicate the modeled probability of Field Sparrow occurrence.
Additional Status and Trends data can be accessed using the <a href="https://ebird.github.io/ebirdst/"><code>ebirdst</code> R
package</a>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">library</span>(colorist)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="co"># load data </span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;fiespa_occ&quot;</span>)</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>fiespa_occ</span></code></pre></div>
<p>After confirming the data have been loaded correctly, we use
<code>metrics_pull()</code> to transform occurrence values from the
stack into intensity values that range from 0 (i.e., cells without Field
Sparrows) to 1 (i.e., the cell[s] with the highest occurrence value
anywhere in the stack). This process of “pulling” metrics from the
<code>RasterStack</code> preserves all of the information in the
original stack while preparing layers for subsequent visualization.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co"># pull information from the stack</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">metrics_pull</span>(fiespa_occ)</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>m1</span></code></pre></div>
<p>Next, we want to choose a color palette that helps communicate
temporal information about Field Sparrow occurrence. Among the three
palette functions currently included in <code>colorist</code>, we want
to use <code>palette_timecycle()</code> because our data layers
represent an ordered sequence of distributions that circles back on
itself (i.e., the distribution of Field Sparrows in December is
temporally adjacent to both November and January distributions).</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># generate a color palette</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">palette_timecycle</span>(fiespa_occ)</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="fu">head</span>(p1)</span></code></pre></div>
<p>The <code>palette_timecycle()</code> function returns a data frame
with three fields: <code>specificity</code>, <code>layer_id</code>, and
<code>color</code>. The <code>specificity</code> and
<code>layer_id</code> fields will be used to assign colors to specific
raster cells.</p>
<p>To visualize our distributions in individual facets, we provide the
<code>map_multiples()</code> function with distribution metrics and
palette information. The structure of the plot and labels for each
distribution within the plot can be specified using the
<code>ncol</code> and <code>labels</code> arguments, respectively.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="co"># map each of the layers</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="fu">map_multiples</span>(m1, p1, <span class="at">ncol =</span> <span class="dv">4</span>, <span class="at">labels =</span> <span class="fu">names</span>(fiespa_occ))</span></code></pre></div>
<p>If we want to extract one month of data for closer inspection, we can
use <code>map_single()</code> and specify which month of data we would
like to see using the layer argument.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="co"># map one layer</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="fu">map_single</span>(m1, p1, <span class="at">layer =</span> <span class="dv">6</span>)</span></code></pre></div>
<p>To generate a single annual cycle map that synthesizes spatiotemporal
information about Field Sparrow occurrence, we need to “distill” the
distributional information in our <code>RasterStack</code> using
<code>metrics_distill()</code>.</p>
<p>The <code>metrics_distill()</code> function calculates distribution
metrics across all layers in every raster cell and returns three metrics
for subsequent visualization:</p>
<ol style="list-style-type: decimal">
<li>Maximum intensity (i.e., the maximum occurrence, abundance, or
density value).</li>
<li>Layer of maximum intensity (i.e., the identity of the layer
containing the maximum intensity value)</li>
<li>Specificity of the maximum intensity value to the layer of maximum
intensity (i.e., the degree to which intensity values are unevenly
distributed across layers).</li>
</ol>
<p>While the maximum intensity and layer of maximum intensity metrics
are relatively easy to grasp, the calculation and meaning of
“specificity” warrants further explanation. We define specificity
according to the following equation:</p>
<p><span class="math display">\[
specificity=50\times \frac{\sum_{l=1}^{n}|y_l-\bar{y}|}{(n-1)\cdot
\bar{y}}
\]</span> where <span class="math inline">\(n\)</span> indicates the
number of layers in the <code>RasterStack</code>, <span class="math inline">\(y_l\)</span> is the intensity value in layer <span class="math inline">\(l\)</span>, and <span class="math inline">\(\bar{y}\)</span> is the mean intensity value
across layers. Specificity values can range from 0 to 100. Values of 0
indicate intensity values are identical in all layers, while values of
100 indicate intensity values are restricted to a single layer.</p>
<p>The interpretation of specificity values depends on the nature of the
data layers being explored. In the case of Field Sparrow, where raster
layers describe the distribution of a species at different times of the
year, specificity can be interpreted as a measure of seasonality (i.e.,
0 = stable year-round occurrence in a cell, 100 = highly seasonal
occurrence).</p>
<p>After providing <code>metrics_distill()</code> with the
<code>fiespa_occ</code> data, the <code>map_single()</code> function
combines the resulting distribution metrics and palette information to
generate a map.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co"># distill distribution information across layers</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>m1_distill <span class="ot">&lt;-</span> <span class="fu">metrics_distill</span>(fiespa_occ)</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="co"># visualize distilled information on a single map</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="fu">map_single</span>(m1_distill, p1)</span></code></pre></div>
<p>Interpreting annual cycle maps becomes straightforward with a little
experience, but a legend is typically required to orient viewers. We can
generate a legend for the Field Sparrow annual cycle map using
<code>legend_timecycle()</code>, a function that requires a data frame
generated by <code>palette_timecycle()</code>. Information about when
the time cycle begins (and ends) can also be provided in the
origin_label argument. When interpreting the legend and map, remember
that specificity indicates degree of seasonality in Field Sparrow
occurrence.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co"># generate a legend</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="fu">legend_timecycle</span>(p1, <span class="at">origin_label =</span> <span class="st">&quot;Jan 1&quot;</span>)</span></code></pre></div>
<p>With an annual cycle map and legend in hand, we can now figure out
where to find Field Sparrows in space and time. Very colorful cells
indicate areas with high occurrence probabilities, but only during
specific times of year. For example, rich blue colors towards the bottom
of the map indicate that birds occur in those cells with high
probability, but almost exclusively in the winter months. In contrast,
dark gray areas indicate consistently high occurrence probabilities in
cells throughout the year.</p>
</div>
<div id="map-individual-behavior-over-time" class="section level3">
<h3>2. Map individual behavior over time</h3>
<p>Researchers have been placing devices on animals for more than a half
century to record individual movements through space and time. In recent
years, tracking devices have become smaller, lighter, and increasingly
capable of recording data with high spatiotemporal resolution. As a
result, it is now possible to understand and communicate how individual
animals use their environments in much more detail than was feasible
with coarse tracking data and traditional home range maps.</p>
<p>Here, we use <code>colorist</code> to explore how an individual
Fisher (<em>Pekania pennanti</em>) living in upstate New York moved
through its local environment over a period of nine sequential nights in
2011. Fisher are omnivorous mammals in the weasel family that occur in
boreal forests throughout Canada and the United States. They tend to be
solitary throughout most of the year but males and females will
sometimes inhabit overlapping territories.</p>
<p>We start by loading the <code>fisher_ud</code> data set, which
contains utilization distributions calculated for an individual animal
(MP5) on each of nine sequential nights in April 2011. Cell values in
each raster layer indicate the probability density of cell use between
sunset and sunrise.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="co"># loda data</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;fisher_ud&quot;</span>)</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>fisher_ud</span></code></pre></div>
<p>After loading the data, let’s begin by visualizing information in
each of the layers. We do this by “pulling” information from the
<code>RasterStack</code> and combining it with a color palette in
<code>map_multiples()</code>. The Fisher data differ from the Field
Sparrow data in the previous example in that they describe a linear
sequence of distributions, not a cyclical sequence. So, we need to use
<code>palette_timeline()</code> rather than
<code>palette_timecycle()</code> to generate our color palette.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="co"># pull information from the stack</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">metrics_pull</span>(fisher_ud)</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="co"># generate a color palette</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">palette_timeline</span>(fisher_ud)</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a><span class="co"># map each of the layers</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a><span class="fu">map_multiples</span>(m2, p2)</span></code></pre></div>
<p>Many of the maps appear relatively washed out because intensity
values in every cell have been scaled relative to the highest intensity
value in the entire <code>RasterStack</code>. It is not uncommon for
distributions to contain highly skewed intensity values because
individual animals spend a vast majority of their time within a
relatively small area or, in the case of species distributions, because
populations are relatively dense during some seasons and relatively
dispersed during others. This can make visualizing distributions a
challenge.</p>
<p>The <code>lambda_i</code> parameter in <code>map_multiples()</code>
and <code>map_single()</code> allows users to visually tune the relative
weights of high and low intensity values using a modulus transformation
(see [scales::modulus_trans()]). In this case, we want to reduce the
disparity between the visual weights of high and low intensity values,
so we set <code>lambda_i = -5</code>.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="co"># map each of the layers and adjust visual weights</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="fu">map_multiples</span>(m2, p2, <span class="at">lambda_i =</span> <span class="sc">-</span><span class="dv">5</span>)</span></code></pre></div>
<p>This enables us to better see the places where our focal animal spent
at least some time as it moved across the landscape. To further explore
how MP5 moved throughout its territory over the course of nine nights,
we can “distill” distributional information from across all nine layers
and use the resulting metrics to visualize patterns of space use with
<code>map_single()</code>.</p>
<p>It is important to remember that specificity values (and resulting
visualization of specificity values) for Fisher should be interpreted
differently than for Field Sparrow. Here, specificity values indicate
the degree to which MP5 used the same locations within the landscape
across nine nights. Low specificity suggests consistent use through
time. High specificity suggests very inconsistent or ephemeral use.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="co"># distill distribution information across layers</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>m2_distill <span class="ot">&lt;-</span> <span class="fu">metrics_distill</span>(fisher_ud)</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a><span class="co"># visualize distilled information on a single map</span></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a><span class="fu">map_single</span>(m2_distill, p2, <span class="at">lambda_i =</span> <span class="sc">-</span><span class="dv">5</span>)</span></code></pre></div>
<p>Output from <code>legend_timeline()</code> will help to orient
viewers and we can use the <code>time_labels</code> argument to indicate
the ends of the timeline. Looking across the nine nights, MP5 spent
relatively little of its time anchored in one area. The bright colors
seen throughout the map are the result of high specificity values, which
indicate that MP5 explored different parts of its territory almost every
night.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="co"># generate a legend</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="fu">legend_timeline</span>(p2, <span class="at">time_labels =</span> <span class="fu">c</span>(<span class="st">&quot;April 7&quot;</span>, <span class="st">&quot;April 15&quot;</span>))</span></code></pre></div>
</div>
<div id="map-distributions-of-multiple-individuals-during-the-same-time-period" class="section level3">
<h3>3. Map distributions of multiple individuals during the same time
period</h3>
<p>In the previous examples, we used <code>colorist</code> to explore
the distributions of a single species and a single individual across
multiple time periods. Other conceptualizations and uses of
<code>colorist</code> functions are possible, however. For example,
<code>colorist</code> can also be used to explore the distribution of
multiple species or individuals within a single time period.</p>
<p>Here, we use GPS tracking data collected from African Elephants
(<em>Loxodonta africana</em>) in Etosha National Park, Namibia during
2011 to explore how two individuals used the landscape over the course
of a year. The African Elephant is an iconic species with a complex
social system that remains a target of poachers throughout much of
Africa. Many populations of African Elephants move seasonally along
specific migratory routes, tracking availability of seasonally abundant
resources.</p>
<p>To begin, we load the <code>elephant_ud</code> data set which
contains utilization distributions for two individual elephants (LA11
and LA14) during 2011. Because the utilization distributions form an
unordered set (i.e., they need not be presented in any specific cyclical
or linear sequence), we use the <code>palette_set()</code> function to
assign them colors. Then, we map the two distributions using
<code>map_multiples()</code> while adding visual emphasis to rarely used
areas with the <code>lambda_i</code> argument and adding identifiers to
each map with the labels argument.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="co"># load data</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;elephant_ud&quot;</span>)</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a><span class="co"># pull information from the stack</span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>m3 <span class="ot">&lt;-</span> <span class="fu">metrics_pull</span>(elephant_ud)</span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a><span class="co"># assign a color palette</span></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">palette_set</span>(elephant_ud)</span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a><span class="co"># generate maps for each individual</span></span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a><span class="fu">map_multiples</span>(m3, p3, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">lambda_i =</span> <span class="sc">-</span><span class="dv">5</span>, <span class="at">labels =</span> <span class="fu">names</span>(elephant_ud))</span></code></pre></div>
<p>The utilization distributions for LA11 and LA14 look remarkably
similar at first glance, which is not surprising given the two elephants
belong to the same herd. However, we can more clearly understand the
similarities and differences in how they used space in 2011 by
“distilling” distributional information from across the two raster
layers with <code>metrics_distill()</code> and visualizing the resulting
metrics with <code>map_single()</code>.</p>
<p>Before generating the map, however, we should recalibrate our
understanding of what specificity values mean based on the nature of the
data we are exploring. In contrast to the Field Sparrow and Fisher
examples, where specificity indicated the degree to which intensity
values were inconsistent (or consistent) through time, here specificity
values can be interpreted as a measure of differential use of the
landscape. Very low specificity values indicate equal use of a cell by
both individuals; very high specificity values indicate exclusive use by
one individual.</p>
<p>Accordingly, if the two utilization distributions were identical, we
would expect <code>map_single()</code> to produce a range of gray values
indicating where the pair spent relatively more or less time. There
would not be any blue or red cells indicating areas were being used
differentially. In contrast, if the two distributions were only
superficially similar then we would expect <code>map_single()</code> to
produce blue and red cells indicating exclusive use of areas by each
individual, and very few gray cells indicating equal use.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="co"># distill distribution information across individuals</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>m3_distill <span class="ot">&lt;-</span> <span class="fu">metrics_distill</span>(elephant_ud)</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a><span class="co"># visualize distilled information on a single map</span></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a><span class="fu">map_single</span>(m3_distill, p3, <span class="at">lambda_i =</span> <span class="sc">-</span><span class="dv">5</span>)</span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a><span class="co"># generate a legend</span></span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a><span class="fu">legend_set</span>(p3, <span class="at">group_labels =</span> <span class="fu">names</span>(elephant_ud))</span></code></pre></div>
<p>Despite the general similarity of the two utilization distributions,
some places were used almost exclusively by LA11 (i.e., blue cells) and
others were used almost exclusively by LA14 (i.e., red cells). We can
contextualize these patterns by adding information about the locations
of pans, waterholes, roads, and boundaries to the map. These
environmental data layers can be <a href="https://github.com/mstrimas/colorist/raw/master/data-raw/etosha-features.gpkg">downloaded
as a GeoPackage</a> from the package GitHub repository, which we do
below.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="co"># download data to a temp directory</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&quot;https://github.com/mstrimas/colorist/raw/master/data-raw/&quot;</span></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="fu">tempdir</span>(), <span class="st">&quot;etosha-features.gpkg&quot;</span>)</span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a><span class="fu">download.file</span>(<span class="fu">paste0</span>(url, <span class="fu">basename</span>(f)), f)</span></code></pre></div>
<p>We can then read the spatial data from the GeoPackage into R and
ensure that the data are described by the same coordinate reference
system as the elephant data.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>pans <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(f, <span class="at">layer =</span> <span class="st">&quot;pans&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(elephant_ud))</span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a>waterholes <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(f, <span class="at">layer =</span> <span class="st">&quot;waterholes&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(elephant_ud))</span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a>park <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(f, <span class="at">layer =</span> <span class="st">&quot;etosha&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(elephant_ud))</span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a>roads <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(f, <span class="at">layer =</span> <span class="st">&quot;roads&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(elephant_ud))</span></code></pre></div>
<p>Then we use <code>map_single()</code> to reproduce our map of LA11
and LA14 distributions, but we append <code>geom_sf()</code> line
objects to our <code>map_single()</code> function. These additional
lines of code allow us to add environmental context to our underlying
elephant map (which is a <code>ggplot</code> object) and communicate
additional information about how elephants LA11 and LA14 navigate Etosha
National Park.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="co"># visualize both distributions on a single map and add environmental data </span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>elephant_map <span class="ot">&lt;-</span> <span class="fu">map_single</span>(m3_distill, p3, <span class="at">lambda_i =</span> <span class="sc">-</span><span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> pans, <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">size =</span> <span class="fl">0.15</span>, <span class="at">color =</span> <span class="st">&quot;gray40&quot;</span>) <span class="sc">+</span> </span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> waterholes, <span class="at">size =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> park, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="fu">alpha</span>(<span class="st">&quot;gray60&quot;</span>, <span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> park, <span class="at">size =</span> <span class="fl">0.2</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">&quot;gray20&quot;</span>, <span class="at">linetype =</span> <span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Two Elephants in Etosha National Park&quot;</span>) </span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a><span class="co"># show the map</span></span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a>elephant_map</span></code></pre></div>
<p>The resulting map object (<code>elephant_map</code>) could be saved
using the <code>ggsave()</code> function.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="co"># save the map</span></span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">plot =</span> elephant_map,</span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>       <span class="at">filename =</span> <span class="st">&quot;afrele_map_singles.png&quot;</span>,</span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">6</span>,</span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a>       <span class="at">height =</span> <span class="fl">3.5</span>,</span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a>       <span class="at">dpi =</span> <span class="dv">600</span>)</span></code></pre></div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
